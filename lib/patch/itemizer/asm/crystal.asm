PHP
TXA
PHA

TSX
INX
INX
TXS

PLA
STA $6001
PLA 
STA $6002
PHA 
LDA $6001
PHA

DEX
DEX
TXS

TYA
PHA

LDY #$00

CHECK LDA $6030,Y
CMP $6001
BNE NEXT

CHECK LDA $6031,Y
CMP $6002
BNE NEXT

LDA $6032,Y
CMP *$30
BNE NEXT

LDA $6033,Y
CMP *$50
BNE NEXT

LDA *$51
AND #$7
STA $6000
LDA $6034,Y
CMP $6000
BNE NEXT

BEQ DONE

NEXT CPY #$A
BEQ CRYS
INY
INY
INY
INY
INY
BNE CHECK

CRYS LDA $91
AND #$60
CLC
ROR A
ROR A
ROR A
ROR A
ROR A
STA $6000
ASL A
ASL A
ADC $6000
TAY
LDA $6001
STA $6030,Y
LDA $6002
STA $6031,Y
LDA *$30
STA $6032,Y
LDA *$50
STA $6033,Y
LDA *$51
AND #$7
STA $6034,Y

LDA *$91
CLC
ADC #$20
STA *$91

DONE 
PLA
TAY
PLA
TAX
PLP

LDA $91

RTS
